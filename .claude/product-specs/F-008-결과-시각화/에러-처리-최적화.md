# F-008: 결과 시각화 - 에러 처리 및 최적화

**상위 문서**: [F-008: 결과 시각화](../F-008-결과-시각화.md)
**최종 수정일**: 2025-11-11

---

## 개요

워크플로우 실행 결과의 에러 처리, 데이터 타입 정의, 성능 최적화를 다룹니다.

---

## 에러 표시

### 스텝 에러

```typescript
function StepErrorCard({ error }: { error: string }) {
  return (
    <Alert variant="destructive">
      <XCircle className="h-4 w-4" />
      <AlertTitle>실행 실패</AlertTitle>
      <AlertDescription>
        <pre className="mt-2 text-sm whitespace-pre-wrap">{error}</pre>
      </AlertDescription>
    </Alert>
  );
}
```

**시나리오**: 셀렉터 찾기 실패, API 에러, 타임아웃, 스크립트 실행 실패

---

### 전체 워크플로우 에러

```typescript
function WorkflowErrorPanel({ error }: { error: Error }) {
  return (
    <Card className="p-4 border-red-500">
      <div className="flex items-start gap-3">
        <XCircle className="h-5 w-5 text-red-500 mt-0.5" />
        <div className="flex-1">
          <h3 className="font-semibold text-red-500 mb-2">워크플로우 실행 실패</h3>
          <p className="text-sm mb-3">{error.message}</p>
          {error.stack && (
            <details>
              <summary className="cursor-pointer text-sm text-muted-foreground">
                스택 트레이스 보기
              </summary>
              <pre className="mt-2 p-3 bg-muted rounded text-xs overflow-x-auto">
                {error.stack}
              </pre>
            </details>
          )}
        </div>
      </div>
    </Card>
  );
}
```

**시나리오**: Extension 연결 실패, 네트워크 에러, 런타임 예외

---

## 실행 결과 구조

### WorkflowExecutionResult

```typescript
interface WorkflowExecutionResult {
  success: boolean;
  context: ExecutionContext;
  steps: { [stepId: string]: StepExecutionResult };
  totalExecutionTime: number;  // ms
  completedAt: string;          // ISO
}
```

---

### StepExecutionResult

```typescript
interface StepExecutionResult {
  stepId: string;
  block: Block;
  result: { success: boolean; data?: any; error?: string };
  executionTime: number;
  timestamp: string;
}
```

---

### ExecutionContext

```typescript
interface ExecutionContext {
  workflow: FormWorkflow;
  steps: { [stepId: string]: { result: { data?: any; error?: string } } };
  forEach?: { item: any; index: number };
  loop?: { index: number; count: number };
}
```

---

## 성능 최적화

### 대용량 데이터 처리

```typescript
import { FixedSizeList } from "react-window";

function VirtualizedTableView({ data }: { data: any[] }) {
  return (
    <FixedSizeList height={600} itemCount={data.length} itemSize={40} width="100%">
      {({ index, style }) => <div style={style}>{/* Row */}</div>}
    </FixedSizeList>
  );
}
```

**전략**: 가상화 스크롤, 10,000개 이상 지원
**계획**: Q2 2025, react-window

---

### 페이지네이션

```typescript
function PaginatedTableView({ data, pageSize = 100 }: { data: any[]; pageSize?: number }) {
  const [page, setPage] = useState(0);
  const totalPages = Math.ceil(data.length / pageSize);
  const paginatedData = data.slice(page * pageSize, (page + 1) * pageSize);

  return (
    <>
      <Table data={paginatedData} />
      <div className="flex justify-between items-center mt-4">
        <span className="text-sm text-muted-foreground">
          Showing {page * pageSize + 1} - {Math.min((page + 1) * pageSize, data.length)} of {data.length}
        </span>
        <div className="flex gap-2">
          <Button size="sm" disabled={page === 0} onClick={() => setPage(page - 1)}>Previous</Button>
          <Button size="sm" disabled={page === totalPages - 1} onClick={() => setPage(page + 1)}>Next</Button>
        </div>
      </div>
    </>
  );
}
```

**전략**: 100개 이상 시 자동 활성화, 범위 표시

---

## 알려진 이슈

### Issue-001: 실행 히스토리 미저장

**문제**: 이전 결과 확인 불가, 새로고침 시 사라짐
**대안**: 수동 Export, 콘솔 확인
**계획**: Q2 2025, DB 저장

---

### Issue-002: 실행 상태 미표시

**문제**: 완료 후에만 확인, 진행 중 미표시
**대안**: Extension 콘솔, 타임아웃
**계획**: Q1 2025, WebSocket 실시간 전달

---

## 향후 개선사항

### Q1 2025
- 실시간 진행 상황 (WebSocket)
- 중간 결과 표시
- 결과 비교

### Q2 2025
- 실행 히스토리 (DB 저장)
- 결과 공유 (URL)
- 고급 필터링
- 차트 시각화

---

## 관련 문서

- [F-008: 결과 시각화](../F-008-결과-시각화.md)
- [뷰 모드 구현](./뷰-모드-구현.md)
- [F-007: 워크플로우 실행](../F-007-워크플로우-실행.md)

---

## 파일 위치

- `app/client/admin/workflowBuilder/ResultPanel.tsx`
- `app/models/workflow/WorkflowRunner.ts`

---

## 문서화 원칙 체크리스트

- [x] 한글로 작성
- [x] 200줄 이하
- [x] 상위 문서 링크
- [x] 코드 예제
- [x] 관련 문서 링크
- [x] 파일 위치 명시
