# F-008: 결과 시각화 - 뷰 모드 구현

**상위 문서**: [F-008: 결과 시각화](../F-008-결과-시각화.md)
**최종 수정일**: 2025-11-11

---

## 개요

워크플로우 실행 결과를 표시하는 세 가지 뷰 모드(JSON, Table, Raw)와 Export 기능 구현을 다룹니다.

---

## 뷰 모드

### 1. JSON 뷰

**특징**: 트리 구조, 스텝별 접기/펼치기, 구문 하이라이팅

```typescript
function JsonView({ results }: { results: WorkflowExecutionResult }) {
  return (
    <div className="space-y-2">
      {Object.entries(results.steps).map(([stepId, stepResult]) => (
        <StepResultCard key={stepId} stepId={stepId} result={stepResult} />
      ))}
    </div>
  );
}

function StepResultCard({ stepId, result }: { stepId: string; result: StepExecutionResult }) {
  const [isExpanded, setIsExpanded] = useState(false);

  return (
    <Card className="p-3">
      <div className="flex items-center justify-between cursor-pointer"
        onClick={() => setIsExpanded(!isExpanded)}>
        <div className="flex items-center gap-2">
          {isExpanded ? <ChevronDown /> : <ChevronRight />}
          <span className="font-semibold">{stepId}</span>
          <Badge variant={result.result.success ? "default" : "destructive"}>
            {result.result.success ? "Success" : "Failed"}
          </Badge>
          <span className="text-sm text-muted-foreground">({result.executionTime}ms)</span>
        </div>
      </div>
      {isExpanded && (
        <div className="mt-3">
          {result.result.success ? (
            <pre className="p-3 bg-muted rounded text-sm overflow-x-auto">
              {JSON.stringify(result.result.data, null, 2)}
            </pre>
          ) : (
            <Alert variant="destructive">
              <AlertDescription>{result.result.error}</AlertDescription>
            </Alert>
          )}
        </div>
      )}
    </Card>
  );
}
```

---

### 2. Table 뷰

**특징**: 배열 데이터를 테이블로 표시, 정렬, 페이지네이션 (100개 이상)

```typescript
function TableView({ results }: { results: WorkflowExecutionResult }) {
  const data = results.parser ? evaluateParser(results) : getLastStepData(results);

  if (!Array.isArray(data) || data.length === 0) {
    return <Alert><AlertDescription>테이블 뷰는 배열 데이터만 지원합니다.</AlertDescription></Alert>;
  }

  const columns = Object.keys(data[0]);

  return (
    <div className="overflow-x-auto">
      <Table>
        <TableHeader>
          <TableRow>
            {columns.map((col) => <TableHead key={col}>{col}</TableHead>)}
          </TableRow>
        </TableHeader>
        <TableBody>
          {data.map((row, idx) => (
            <TableRow key={idx}>
              {columns.map((col) => (
                <TableCell key={col}>{renderCellValue(row[col])}</TableCell>
              ))}
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </div>
  );
}

function renderCellValue(value: any): string {
  if (value === null || value === undefined) return "-";
  if (typeof value === "object") return JSON.stringify(value);
  return String(value);
}
```

---

### 3. Raw 뷰

**특징**: 전체 JSON 표시, 복사 가능, 디버깅용

```typescript
function RawView({ results }: { results: WorkflowExecutionResult }) {
  return (
    <pre className="p-4 bg-muted rounded text-sm overflow-x-auto">
      {JSON.stringify(results, null, 2)}
    </pre>
  );
}
```

---

## Export 기능

### CSV Export

```typescript
function exportToCSV(results: WorkflowExecutionResult) {
  const data = results.parser ? evaluateParser(results) : getLastStepData(results);

  if (!Array.isArray(data) || data.length === 0) {
    alert("Export할 데이터가 없습니다.");
    return;
  }

  const columns = Object.keys(data[0]);
  const csvHeader = columns.join(",");
  const csvRows = data.map((row) =>
    columns.map((col) => {
      const value = row[col];
      if (typeof value === "string" && value.includes(",")) return `"${value}"`;
      return value;
    }).join(",")
  );

  const csv = [csvHeader, ...csvRows].join("\n");

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.href = url;
  link.download = `workflow-results-${Date.now()}.csv`;
  link.click();
  URL.revokeObjectURL(url);
}
```

**CSV 규칙**: 첫 객체 키를 헤더로 사용, 쉼표 포함 시 따옴표 감싸기, null/undefined는 빈 값

---

### JSON Export

```typescript
function exportToJSON(results: WorkflowExecutionResult) {
  const json = JSON.stringify(results, null, 2);
  const blob = new Blob([json], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.href = url;
  link.download = `workflow-results-${Date.now()}.json`;
  link.click();
  URL.revokeObjectURL(url);
}
```

---

## 관련 문서

- [F-008: 결과 시각화](../F-008-결과-시각화.md) - 상위 문서
- [에러 처리 및 최적화](./에러-처리-최적화.md)

---

## 파일 위치

- `app/client/admin/workflowBuilder/ResultPanel.tsx`
- `app/client/admin/workflowBuilder/WorkflowBuilderPage.tsx`

---

## 문서화 원칙 체크리스트

- [x] 한글로 작성
- [x] 200줄 이하
- [x] 상위 문서 링크
- [x] 코드 예제
- [x] 관련 문서 링크
- [x] 파일 위치 명시
