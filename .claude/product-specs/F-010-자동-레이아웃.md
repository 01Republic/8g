# F-010: 자동 레이아웃

**기능 ID**: F-010
**우선순위**: P1 (High)
**상태**: ✅ 구현완료
**담당**: Frontend Team
**최종 수정일**: 2025-11-11

---

## 개요

자동 레이아웃은 워크플로우 노드를 시각적으로 보기 좋게 자동 배치하는 기능입니다. Dagre 알고리즘을 사용하여 계층적 구조로 노드를 배치하며, 엣지 겹침을 최소화합니다.

**핵심 가치**:

- 가독성 향상
- 복잡한 워크플로우 정리
- 사용자 편의성
- 일관된 레이아웃

---

## 문서 인덱스

이 기능에 대한 상세 정보는 다음 하위 문서에서 확인할 수 있습니다:

### 📘 핵심 문서

- **[레이아웃 알고리즘](./F-010-자동-레이아웃/레이아웃-알고리즘.md)** - Dagre 알고리즘, autoLayout 함수 구현, 동적 노드 크기 계산

### 📗 실전 가이드

- **[레이아웃 전략](./F-010-자동-레이아웃/레이아웃-전략.md)** - 레이아웃 방향, 워크플로우 패턴별 전략, 성능 최적화, 커스텀 레이아웃

---

## Dagre 알고리즘

**Dagre**: 방향 그래프(Directed Graph) 레이아웃 라이브러리

**특징**:

- 계층적(Hierarchical) 배치
- 엣지 교차 최소화
- 노드 간격 자동 계산
- 여러 레이아웃 방향 지원

**공식 사이트**: https://github.com/dagrejs/dagre

---

## 레이아웃 방향

### Top-to-Bottom (TB)

위에서 아래로 배치. 일반적인 워크플로우에 적합.

### Left-to-Right (LR)

왼쪽에서 오른쪽으로 배치. 넓은 화면, 긴 선형 워크플로우에 적합.

### Right-to-Left (RL)

오른쪽에서 왼쪽으로 배치. RTL 언어 지원 시 사용.

### Bottom-to-Top (BT)

아래에서 위로 배치. 특수 케이스.

상세한 사용 사례는 [레이아웃 전략](./F-010-자동-레이아웃/레이아웃-전략.md) 문서를 참고하세요.

---

## 기본 사용법

### 워크플로우 로드 시 자동 레이아웃

```typescript
// app/routes/workflow-builder.tsx
const { nodes, edges } = convertWorkflowToNodesAndEdges(workflow.meta);
const layoutedNodes = applyDagreLayout(nodes, edges);
```

### 수동 레이아웃 버튼

```typescript
// WorkflowBuilderHeader.tsx
const handleAutoLayout = () => {
  const layoutedNodes = applyDagreLayout(nodes, edges);
  setNodes(layoutedNodes);
};
```

구현 상세는 [레이아웃 알고리즘](./F-010-자동-레이아웃/레이아웃-알고리즘.md) 문서를 참고하세요.

---

## 주요 기능

### ✅ 구현 완료

- Dagre 기반 자동 레이아웃
- Top-to-Bottom, Left-to-Right 방향
- 동적 노드 크기 계산
- 워크플로우 로드 시 자동 적용
- 수동 레이아웃 버튼
- CSS 트랜지션 애니메이션

### 🔄 계획 중

- 수동 배치 보존 옵션 (Q1 2025)
- 레이아웃 미리보기 (Q1 2025)
- Web Worker 백그라운드 레이아웃 (Q2 2025)
- 커스텀 레이아웃 엔진 - 원형, 그리드 (Q2 2025)
- 레이아웃 템플릿 저장 (Q2 2025)

---

## 워크플로우 패턴

### 선형 워크플로우

`[Start] → [Step 1] → [Step 2] → [End]`

**추천**: Top-to-Bottom 또는 Left-to-Right

### 분기 워크플로우

```
    [Start]
       ↓
   [Condition]
    ↙   ↘
[Branch A] [Branch B]
```

**추천**: Top-to-Bottom, 넓은 nodeSep

### 복합 워크플로우

루프, 분기, 조건이 혼합된 복잡한 구조

**추천**: Dagre 자동 최적화

상세한 전략은 [레이아웃 전략](./F-010-자동-레이아웃/레이아웃-전략.md) 문서를 참고하세요.

---

## 성능 최적화

### 대규모 그래프 (100+ 노드)

- 간소화된 레이아웃 옵션 사용
- 레이아웃 캐싱
- Web Worker 백그라운드 계산 (계획)

### 반응형 레이아웃

- 화면 크기에 따라 TB ↔ LR 자동 전환
- 모바일: Top-to-Bottom 고정

최적화 기법은 [레이아웃 전략](./F-010-자동-레이아웃/레이아웃-전략.md) 문서를 참고하세요.

---

## 알려진 이슈

**Issue-001: 복잡한 그래프 레이아웃 지연**

- 100개 이상 노드 시 1-2초 소요
- 대안: Web Worker 사용 계획
- 계획: Q2 2025

**Issue-002: 수동 배치 후 자동 레이아웃 적용 시 위치 손실**

- 사용자 수동 배치가 초기화됨
- 대안: "레이아웃 초기화" 경고 표시
- 계획: Q1 2025 - 수동 배치 보존 옵션

---

## 관련 문서

### 기능 명세

- [F-001: 워크플로우 빌더](./F-001-워크플로우-빌더.md)

### 외부 문서

- [React Flow 문서](https://reactflow.dev/)
- [Dagre 문서](https://github.com/dagrejs/dagre/wiki)

---

## 파일 위치

### Frontend

- `app/client/admin/workflowBuilder/utils/autoLayout.ts` - autoLayout 함수
- `app/client/admin/workflowBuilder/WorkflowBuilderHeader.tsx` - 수동 레이아웃 버튼
- `app/routes/workflow-builder.tsx` - Loader에서 자동 레이아웃 적용

---

**변경 이력**

| 버전 | 날짜       | 변경 내용                             | 작성자 |
| ---- | ---------- | ------------------------------------- | ------ |
| 1.1  | 2025-11-11 | 200줄 제한 준수를 위한 하위 문서 분리 | System |
| 1.0  | 2025-11-11 | 최초 작성                             | System |
