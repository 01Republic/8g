# F-005: 루프 설정

**기능 ID**: F-005
**우선순위**: P1 (High)
**상태**: ✅ 구현완료
**담당**: Frontend Team
**최종 수정일**: 2025-11-11

---

## 개요

루프 설정은 워크플로우에서 반복 작업을 자동화하는 기능입니다. forEach(배열 순회)와 count(고정 횟수) 두 가지 루프 타입을 지원하며, 중첩 루프도 가능합니다.

**핵심 가치**:

- 반복 작업 자동화
- 대량 데이터 처리
- 페이지네이션 처리
- 동적 목록 처리

---

## 문서 인덱스

이 기능에 대한 상세 정보는 다음 하위 문서에서 확인할 수 있습니다:

### 📘 핵심 문서

- **[루프 실행 로직](./F-005-루프-설정/루프-실행로직.md)** - Extension에서의 실행 메커니즘 및 컨텍스트 관리

### 📗 실전 가이드

- **[루프 예제](./F-005-루프-설정/루프-예제.md)** - 페이지네이션, 링크 순회, 중첩 루프 등 다양한 사용 예시

### 📙 고급 기능

- **[루프 고급 기능](./F-005-루프-설정/루프-고급기능.md)** - 성능 최적화, 에러 처리, 배치 처리, 디버깅

---

## 루프 타입

### forEach 루프

배열의 각 요소에 대해 스텝을 반복 실행합니다.

```json
{
  "repeat": { "forEach": "$.steps.get_links.result.data" }
}
```

**컨텍스트 변수**: `$.forEach.item`, `$.forEach.index`, `$.forEach.length`

### count 루프

고정 횟수만큼 스텝을 반복 실행합니다.

```json
{
  "repeat": { "count": 5 }
}
```

**동적 설정**: `"count": "${vars.pageCount}"`로 변수 사용 가능

**컨텍스트 변수**: `$.loop.index`, `$.loop.count`

---

## UI 컴포넌트

### RepeatConfigDialog

노드 우클릭 → "루프 설정" 메뉴로 접근 가능

**주요 기능**:

- 루프 타입 선택 (없음 / forEach / count)
- forEach: JSONPath 입력 필드
- count: 반복 횟수 입력 필드
- 루프 제거 버튼

**파일 위치**: `app/client/admin/workflowBuilder/RepeatConfigDialog.tsx`

---

## 빠른 예제

**페이지네이션**: count 루프로 "다음" 버튼 5번 클릭
**링크 순회**: forEach로 배열의 각 URL 방문
**중첩 루프**: 카테고리 순회 → 각 카테고리의 상품 순회

상세한 예제 코드는 [루프 예제 문서](./F-005-루프-설정/루프-예제.md)를 참고하세요.

---

## 주요 기능

### ✅ 구현 완료

- forEach 루프 (배열 순회)
- count 루프 (고정 횟수)
- 중첩 루프 지원
- 컨텍스트 변수 접근
- 지연 시간 설정
- Retry 메커니즘

### 🔄 계획 중

- 루프 진행률 UI (Q1 2025)
- 조기 종료 (`breakWhen`) (Q1 2025)
- 건너뛰기 (`skipWhen`) (Q2 2025)
- 배치 처리 (Q2 2025)
- 병렬 실행 (Q2 2025)
- 루프 중단 버튼 (Q2 2025)

---

## 관련 문서

### 기능 명세

- [F-001: 워크플로우 빌더](./F-001-워크플로우-빌더.md)
- [F-004: 변수 치환](./F-004-변수-치환.md)
- [F-003: 조건부 분기](./F-003-조건부-분기.md)

### PRD

- [워크플로우 JSON 명세](../.claude/prd/워크플로우-JSON-명세.md)

---

## 파일 위치

### Frontend

- `app/client/admin/workflowBuilder/RepeatConfigDialog.tsx` - 루프 설정 다이얼로그
- `app/models/workflow/types.ts` - RepeatConfig 타입 정의

### Backend/Extension

- `scordi-extension` 패키지 - 루프 실행 로직

---

## 알려진 이슈

**Issue-001: 루프 중단 기능 없음**

- 실행 중인 루프를 중간에 멈출 수 없음
- 대안: 브라우저 탭 닫기
- 계획: Q2 2025

**Issue-002: 루프 진행 상황 표시 부족**

- 전체 진행률 확인 어려움
- 대안: Extension 콘솔 로그
- 계획: Q1 2025 - 진행률 바 추가

상세한 제약사항 및 해결 방안은 [루프 고급 기능](./F-005-루프-설정/루프-고급기능.md) 문서를 참고하세요.

---

**변경 이력**

| 버전 | 날짜       | 변경 내용                             | 작성자 |
| ---- | ---------- | ------------------------------------- | ------ |
| 1.1  | 2025-11-11 | 200줄 제한 준수를 위한 하위 문서 분리 | System |
| 1.0  | 2025-11-11 | 최초 작성                             | System |
