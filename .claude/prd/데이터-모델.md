# 데이터 모델

**문서 버전**: 1.1
**최종 수정일**: 2025-11-11
**상위 문서**: [PRD](../PRD.md)

---

## 개요

이 문서는 8G 플랫폼의 데이터베이스 스키마, 엔티티 정의, 그리고 데이터 흐름을 상세히 설명합니다.

---

## 문서 인덱스

이 문서는 200줄 제한 준수를 위해 하위 문서로 분리되어 있습니다.

**상세 문서**:

- [데이터베이스 스키마](./데이터-모델/데이터베이스-스키마.md) - 테이블 정의, TypeORM 엔티티, ERD
- [마이그레이션 가이드](./데이터-모델/마이그레이션-가이드.md) - 마이그레이션 절차, 버전 관리

---

## 데이터베이스 개요

### 핵심 테이블

**integration_app_workflow_metadata**: 워크플로우 메타데이터 및 정의 저장

- id, description, meta (JSON), created_at, updated_at
- TypeORM 엔티티: IntegrationAppWorkflowMetadata

**상세**: [데이터베이스 스키마](./데이터-모델/데이터베이스-스키마.md)

---

## 워크플로우 JSON 구조

**파일 위치**: `app/models/workflow/types.ts`

### 핵심 타입

**FormWorkflow**: version, start, steps, targetUrl, parser, vars
**WorkflowStep**: id, block, repeat, switch, next, delayAfterMs, retry, timeoutMs
**Block**: name + 블록별 설정
**RepeatConfig**: forEach, count
**SwitchCase**: when, next

**상세**: [워크플로우 JSON 명세](./워크플로우-JSON-명세.md)

---

## React Flow 데이터 구조

**WorkflowNode**: id, type, position, data (label, block, schema, etc.)
**WorkflowEdge**: id, source, target, type, data (when, label)

---

## 데이터 변환 로직

### 워크플로우 ↔ React Flow 변환

**Workflow → Nodes/Edges**: `convertWorkflowToNodesAndEdges()`

- 파일: `app/client/admin/workflowBuilder/utils/workflowConverter.ts`
- 흐름: Start 노드 생성 → 스텝을 노드로 변환 → 엣지 생성

**Nodes/Edges → Workflow**: `buildWorkflowJson()`

- 파일: `app/models/workflow/WorkflowBuilder.ts`
- 흐름: 노드 필터링 → 엣지 매핑 → WorkflowStep 생성

---

## 데이터 접근 계층

**파일 위치**: `app/.server/services/workflow/`

### 주요 서비스 함수

- `createWorkflowMetadata()`: 워크플로우 생성
- `findWorkflowMetadata(id)`: 워크플로우 조회
- `findAllWorkflows()`: 워크플로우 목록 (updated_at DESC)
- `updateWorkflowMetadata(id, data)`: 워크플로우 업데이트
- `deleteWorkflowMetadata(id)`: 워크플로우 삭제

---

## 향후 개선사항

### 캐싱 전략

- 메모리 캐싱: Map 기반 인메모리 캐시
- Redis 캐싱: 워크플로우 정의 (TTL: 1시간), 목록 (TTL: 5분)

---

## 관련 문서

- [데이터베이스 스키마](./데이터-모델/데이터베이스-스키마.md)
- [마이그레이션 가이드](./데이터-모델/마이그레이션-가이드.md)
- [PRD](../PRD.md)
- [시스템 아키텍처](./시스템-아키텍처.md)
- [워크플로우 JSON 명세](./워크플로우-JSON-명세.md)

---

**변경 이력**

| 버전 | 날짜       | 변경 내용                                         | 작성자 |
| ---- | ---------- | ------------------------------------------------- | ------ |
| 1.1  | 2025-11-11 | 200줄 제한 준수를 위해 스키마와 마이그레이션 분리 | System |
| 1.0  | 2025-11-11 | 최초 작성                                         | System |
